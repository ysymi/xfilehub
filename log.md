#### 6号下午
因为时间已经过去小一半了,感觉有点紧.
大概知道任务要求做什么以后,想先去看看有没有什么最佳实践。好确定一下具体该怎么做。总结下，第一波收货是 html5 分片 + 原生ajax post  + md5校验 ，第二波是收货是要考虑的问题 网络环境 + 断点续传 + 服务端文件保存方案 最后还有个问题还没有解决 要求里还有一条 还要下载文件，就是不单单是一次上传，还要持久化

想了下，初期的方案是:
前端，利用html5的分片api，将文件分5份，每部分交给一个线程处理，每个线程每次post一块文件，尽量模拟窗口滑动，同时向主线程报告进度，
后端，调研tornado的异步非阻塞怎么利用，配合前端的窗口滑动，将文件写入到磁盘，同时应该有地方记录上传的状态，暂时和文件和用户关系存sqlite吧
暂时先这样吧 ，晚上回去撸一发代码

其实也要清楚，这种事情，要想清楚再做，会更省时间


#### 6号晚上
先从前端入手，js是单线程的，但是要实现多线程还是有办法的，
ajax 这个发出的请求是浏览器的线程 但回调还是js要处理 这里也可以符合要求
web worker 这个貌似真的是有一个运行空间 去后台运行 ，这个空间是浏览器的开的js线程吧
回调 settimeout这种 还是单线程 只不过执行过程是异步的


#### 7号早上
前端暂时写完了， 可以异步向后端提交数据，现在在后端接文件还有好大问题，只有一两个请求会接受，但是大部分都500了
难道是给文件加锁了？
好吧 这里是自己写了一个bug 调了半天 浪费了一些时间 应该用相对的参数，但是用了绝对参数，最后分片的范围全都out of range 了

接下来开始测试 基本功能 发现换个文件 全都500了 ，这回是编码问题，但是最后发现不用转码 blob本身就已经是二进制格式 写的时候 就用二进制写就好了啊

#### 7号晚上
写了个简易的进度展示，发现居然有大于100%的情况 而且 还不是固定的值，打了日志发现，seq编号提交的有重复，但是后端是正确接收seq的，隐约觉得是闭包的坑


#### 8号早上，
果然是闭包的坑，之前只能看到成功返回的block编号只是某几个值，就好像经典的for循环里闭包没用好的症状，但是奇怪的是 这个几个值并不是平均分布的，难道作用域交叉了？这里先留着，先解决主要的问题。


#### 8号晚上
果然一上班 就没有时间捣鼓自己的事情了 还是加紧写了几个功能 比如上传进度 即使更新文件列表等
但是下载有个严重的bug 超过blocksize的文件 由于是多个block存在，拼接并不成功 导致下载的文件比上传的文件大一点点
debug发现 下载顺序按照seq 就不会有大小不一致的问题了 可能是padding导致文件加大了
但是新问题又来了 一来一去 文件大小虽然一直了 但是只要超过一个block 文件还是不能读写
还是拼接文件的问题

定位的时候 花了很多时间 去看别人怎么实现的 没有太关注自己的问题 等到冷静下来测试代码 发现后台到前台传输的是没有问题的 是后台拼文件的方式有问题 但是好像别人也是这么做的啊， ru'g如果不是这里有问题 那就zhi’neng只能是 前台分片传输到后台的问题了 先看看拼文件哪里不对吧

#### 9号下午
现在是前端传过来的blocks 可以合并成原文件 cat blocks > orifile
后端push 给 浏览器的文件 也是一致的 md5 服务端文件 == md5 下载文件
那问题就只有 用python 合并文件了

真是犯了个白痴的白痴问题，踩了个读取文件顺序问题的坑， blocks 没有按顺序读取，所有最后的文件 size是一样的 但是 内容不一样 其实也怪自己 写index的时候 选项是sort-by-key 才不管值呢

#### 9号晚上
晚上往git里放了代码 但依旧碰到一个坑 之前有大文件的提交记录 计算历史的时候 估计用到了这些数据 超过文件限制 不能上传 试了rebase 都不好使  但是在http://stackoverflow.com/a/2197616 这个anser里找到了答案 还不错 很顺利的解决了问题

#### 10号
最后只有半天了 基本的功能也已经出来了 还在局域网用了一下呢 还有一个当初的设计没有实现 就是md5
早上查了下有什么方案算md5 看他们要合并文件算总的md5 不太符合 就准备每一个block留一个md5 但是最后还是除了好麻烦的问题,
选了这个方案 不常规 算md5 要算blob对象的 不是file 也不是 string 绕来绕去还是转成了string 这种办法还是很浪费性能的 不过先实现了再想办法提升吧 